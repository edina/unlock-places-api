package edina.geocrosswalk.service;

import static org.easymock.EasyMock.createMock;
import static org.easymock.EasyMock.expect;
import static org.easymock.EasyMock.replay;
import static org.easymock.EasyMock.verify;
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;

import java.io.IOException;
import java.io.StringReader;
import java.util.ArrayList;
import java.util.LinkedList;
import java.util.List;

import org.jdom.Document;
import org.jdom.JDOMException;
import org.jdom.input.SAXBuilder;
import org.junit.Before;
import org.junit.Test;
import org.postgis.PGgeometry;

import edina.geocrosswalk.domain.BoundingBox;
import edina.geocrosswalk.domain.Feature;
import edina.geocrosswalk.domain.FeatureType;
import edina.geocrosswalk.domain.Footprint;
import edina.geocrosswalk.domain.IFeature;
import edina.geocrosswalk.domain.IFeatureType;
import edina.geocrosswalk.domain.IFootprint;
import edina.geocrosswalk.domain.dao.ISpatialDao;

/**
 * Test cases for <code>ISpatialService</code>.
 * 
 * @author Joe Vernon
 * @author Brian O'Hare
 * 
 */
public class DefaultSpatialServiceTest {

	private ISpatialDao mockSpatialDao;
	private Feature testFeature;
	private Footprint testFootprint;
	private List<IFeature> testFeatures;
	private List<IFootprint> testFootprints;
	private DefaultSpatialService spatialService;
	private DefaultResult result, testFootprintResult, deepResult;

	private FeatureType testFeatureType;
	private List<IFeatureType> testFeatureTypes;

	private String country = null;
	private String count = "true";
	private String srs = "4326";
	private String srs_in = "27700";
	private String identifier = "9656";
	private String searchVariants = "false";
	private String deepSrc = null;
	private Document deepDocument;

	@Before
	public void onSetUp() {
		spatialService = new DefaultSpatialService();

		testFeatureType = new FeatureType();
		testFeatureType.setName("Buffer Zone");
		testFeatureType.setFeatureCode("GN.A.ZNB");
		testFeatureType.setHierarchyLevel(2);
		testFeatureTypes = new LinkedList<IFeatureType>();
		testFeatureTypes.add(testFeatureType);

		testFeature = new Feature();
		testFeature.setIdentifier(8);
		testFeature.setNameOptimised("durhamcounty");
		testFeature.setName("Durham County");
		testFeature.setGazetteer("Boundary-Line");
		testFeature.setFeatureType("county");
		testFeature.setXmin(new Double("-2.354266881942749"));
		testFeature.setXmax(new Double("-1.2380768060684204"));
		testFeature.setYmin(new Double("54.45132827758789"));
		testFeature.setYmax(new Double("54.918609619140625"));
		testFeatures = new LinkedList<IFeature>();
		testFeatures.add(testFeature);

		result = new DefaultResult();
		result.setFeatures(testFeatures);
		result.setTotalResultsCount(1);

		String attestation = "<?xml version='1.0' encoding='UTF-8'?><attestations><attestation variantID='epns-deep-02-b-name-w665'>"+
		"<date begin='1242' end='1242' subtype='simple'>1242</date><source id='bu37' style=''>Fees</source><item>873</item></attestation></attestations>";
		try {
			deepDocument = new SAXBuilder().build(new StringReader(attestation));
		} catch (JDOMException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		} catch (IOException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		}

		deepResult = new DefaultResult();
		deepResult.setDeepAttestations(deepDocument);

		testFootprintResult = new DefaultResult();
		testFootprint = new Footprint();
		testFootprint.setIdentifier(12345);
		testFootprints = new ArrayList<IFootprint>();

		try {
			testFootprint
					.setGeometry(new PGgeometry(
							"POLYGON((-3.3017230249143 55.9762017236874,-3.30173632123675 55.9761206947946,-3.3025984966709 55.9755454412297,-3.30259638314078 55.97548255642,-3.30222938745957 55.9755313597768,-3.30167376940148 55.9756900052942,-3.30101534449735 55.9761283062946,-3.30089683041798 55.9764171298473,-3.30089773515394 55.9764440831225,-3.29989800752896 55.9767422021923,-3.29913306072831 55.9778286683459,-3.29837409084673 55.9790947877137,-3.29770701021976 55.9802341389121,-3.29752835202635 55.980164130971,-3.29629674765597 55.9797637014167,-3.29570240792819 55.9797250056146,-3.29450278783101 55.9798005155634,-3.29378174057634 55.9798080850865,-3.29289449508955 55.9796376723849,-3.29211698897255 55.9793941962742,-3.29130536999706 55.9790881656397,-3.29082021349448 55.9789584512631,-3.29017751910971 55.9789112537802,-3.28993655495583 55.978895794141,-3.28536219679089 55.9733898534053,-3.28841206504618 55.973537733903,-3.28976573640941 55.973280949055,-3.29239320337387 55.9727771349882,-3.29731733418868 55.9714672654557,-3.29496956828435 55.9683466336887,-3.30147973729476 55.9665705871739,-3.29972138984374 55.961916080941,-3.2920458576419 55.9623562489027,-3.29063647569449 55.9657410206925,-3.28536402778794 55.9671620930509,-3.28273804479814 55.9681869630837,-3.28183064636003 55.9683671428986,-3.28076423641631 55.9685849310179,-3.27591359591631 55.9687250900945,-3.27902530821943 55.9707597699535,-3.2752906036891 55.9717061267612,-3.27057624073798 55.972105290746,-3.25703199497699 55.9744908015963,-3.25816227725428 55.9762316590998,-3.25359165120455 55.9771319370083,-3.25091665388976 55.9781745986165,-3.25003937405051 55.9788035825774,-3.24963081989663 55.979553604417,-3.24944241066672 55.9806698519784,-3.24858106494831 55.9812986449755,-3.24733021960969 55.981778615889,-3.24626052963591 55.9834070051605,-3.24403019881235 55.9833396804735,-3.24318453532184 55.9829617904497,-3.24237956010194 55.9828530735385,-3.24201241636128 55.982901698221,-3.24082438172333 55.9833450255221,-3.24077687719121 55.9833634664069,-3.23886020881077 55.9835804608936,-3.23882788975994 55.9835717858713,-3.23794650138693 55.9835806394135,-3.23746863709707 55.9836753059412,-3.23729466039014 55.983748939965,-3.23537795268481 55.9839658804776,-3.23200982226353 55.9839097159312,-3.22591505261685 55.9843119474014,-3.22456181563045 55.9841007332284,-3.22278968153862 55.9838217720685,-3.22263059085318 55.9838592937424,-3.22249768732143 55.9842200685835,-3.22111555471672 55.9841079717892,-3.22048069137574 55.9853274225847,-3.22149893590865 55.9825405152748,-3.22164219344087 55.9819999011525,-3.2215493400128 55.9815964206388,-3.22146211972536 55.9813726219274,-3.2204449836803 55.9811400514695,-3.22061603554313 55.9804643692381,-3.21778909469733 55.9802766639557,-3.21345143849133 55.9799599613353,-3.20992343833929 55.9799047872362,-3.20590633309401 55.9795846731526,-3.20378705184672 55.97947059197,-3.20173187206499 55.9793558495591,-3.19933948797188 55.9797386036891,-3.19582538329031 55.9801321970577,-3.19267317369348 55.9818701798499,-3.19044907560558 55.9825207187844,-3.18787684752992 55.982275942985,-3.18757703786181 55.9824316058598,-3.187009285941 55.9822124118188,-3.18649181986047 55.9820646186065,-3.18633297546861 55.9821110722453,-3.18609588071704 55.982221202987,-3.18593566061918 55.9822227443449,-3.18548146815013 55.9820473758683,-3.18520959245701 55.9820679709495,-3.18492609642263 55.9822324518159,-3.1839362954718 55.9828889840451,-3.18377521617605 55.9828635684812,-3.18252212320206 55.9822465342209,-3.18224394025944 55.982060502589,-3.18215917086595 55.9819085411036,-3.18196192287218 55.9817486766766,-3.18118810722102 55.9816033187927,-3.18078174795586 55.9814184935107,-3.18030196300497 55.9809288396091,-3.17989452092705 55.9807080781505,-3.17949036468669 55.980595114896,-3.17909058479467 55.9806259014952,-3.17631836319601 55.9822339966615,-3.17610866712289 55.9821910723744,-3.17587102986911 55.9822832074525,-3.17560405276047 55.9824654717143,-3.17523004754402 55.9822893194321,-3.17514908674969 55.982263128862,-3.17498968321043 55.9822916105264,-3.17420175331993 55.9827394407513,-3.17403880875113 55.9826511427359,-3.17383560229102 55.9822936047066,-3.17366990632985 55.9821154641561,-3.17354361642132 55.9816493625007,-3.17348465511713 55.9812904691117,-3.17349386856292 55.9810657199531,-3.17343545246664 55.9807247839365,-3.17223636319745 55.9808260597471,-3.17156306995183 55.980823478707,-3.17103482098953 55.9803162688767,-3.17057311897727 55.9798892934898,-3.17080725895308 55.9796803896305,-3.17101500247471 55.9796604354611,-3.17313937311581 55.9799457864625,-3.17329798512483 55.9798903523465,-3.17353833009875 55.9793578546506,-3.17027008235444 55.9788766942676,-3.17028310504841 55.979307930905,-3.17036917855531 55.9795048128903,-3.1698439333347 55.9796266288306,-3.16969834849118 55.9795830669333,-3.16932222879974 55.9793350113579,-3.16904575562305 55.9792028402955,-3.1689968668169 55.979176341585,-3.16864516846009 55.9792066384004,-3.1684401021422 55.9793164314391,-3.1682893392407 55.9796323714672,-3.16808105256591 55.979634345177,-3.16688906977663 55.9794389532345,-3.16676359389268 55.9795300090623,-3.16676819237452 55.9796827396496,-3.16693056718171 55.9797530899615,-3.16910488727543 55.9801009250589,-3.16921705557319 55.980099861279,-3.16973931176487 55.9804094365801,-3.16970918047697 55.9804726283952,-3.16890689607659 55.980444294397,-3.16758507643486 55.9801962154607,-3.16737756586615 55.9802251429171,-3.16733490112368 55.9804052649156,-3.1685910087696 55.9806000632576,-3.16859778192498 55.9808246603821,-3.16863174125475 55.9808872443798,-3.1691151641583 55.9809725290955,-3.17066109107053 55.9812094641999,-3.17105545812783 55.9815292480528,-3.17183223765632 55.9823036819908,-3.17399845008296 55.984493743098,-3.17408264862115 55.9846277344272,-3.1737936432974 55.9846125237154,-3.17108638644721 55.9836138122081,-3.17019578264693 55.983316720602,-3.17018520108456 55.9829663479538,-3.17038621181005 55.9827218159497,-3.16596461300513 55.9812090466652,-3.16524315852481 55.9817370774231,-3.16181198903306 55.9806371734655,-3.16154414920186 55.9807924712965,-3.16102827900904 55.9812286718876,-3.16888683992101 55.9840300837943,-3.16980220558523 55.9835541166778,-3.16983423776467 55.9835538127356,-3.17022238057849 55.9836669412061,-3.17109670503151 55.9839552059862,-3.17145336641906 55.9840866106517,-3.17119178760907 55.9844485502246,-3.17122572155508 55.9845111337515,-3.17422069587173 55.9854801401815,-3.17453202191824 55.9857018360194,-3.17501905998753 55.985903893978,-3.17499193022974 55.9860659079609,-3.17462929945003 55.9862670624183,-3.17479855952724 55.9865619982247,-3.17527831370173 55.9870516918149,-3.17557142679018 55.9872016530771,-3.17755674764675 55.9865896101648,-3.18020354524003 55.9887480105026,-3.18017558135436 55.9888830713298,-3.17996858158373 55.9889299958691,-3.17977298103406 55.9888240368295,-3.1795344908354 55.9888892061567,-3.17953804715164 55.9890060026711,-3.1821022188491 55.9910753034531,-3.18205604773441 55.9911386520199,-3.18173820800425 55.9912315485304,-3.18157654757108 55.9911881729214,-3.18083885807283 55.9906560491106,-3.17983514769036 55.9898119372379,-3.17909720232256 55.9892708243004,-3.17854251667743 55.9894828263237,-3.17862592185372 55.9895898598641,-3.1809884399196 55.9913555627842,-3.18113733599825 55.9915069106558,-3.18102927666877 55.9916427388646,-3.18079156075329 55.9917348838052,-3.1804215486681 55.9916935017993,-3.17766701563419 55.9896888907961,-3.17447437710592 55.9885600943048,-3.17116786561482 55.9873693733699,-3.16831785390674 55.9864258813813,-3.16212808725778 55.9842287713237,-3.16135130035227 55.9839844861467,-3.156847379486 55.9823912798914,-3.15514656811286 55.9817961509777,-3.15465643947089 55.9814862135191,-3.15356049885733 55.9785938623343,-3.15251630078707 55.9779745709115,-3.15213977171411 55.9777084863406,-3.15185535809465 55.9773067654841,-3.15152531217941 55.9769863386142,-3.15092444827163 55.9767223457117,-3.15071484246669 55.9766793776424,-3.14966082521327 55.9762668523541,-3.15077339242671 55.9743333535036,-3.1452301718948 55.9727674257149,-3.14671848730612 55.9710731134344,-3.14537554149466 55.9706362774062,-3.14101043736223 55.9693287954697,-3.13938666118641 55.9691461171046,-3.13731273638852 55.9689136471992,-3.13552804641921 55.969253611343,-3.13571211026993 55.968973330312,-3.13562992095009 55.9689022005343,-3.13227873691882 55.967728839873,-3.13070606545662 55.9665480861581,-3.1288049545621 55.9656399064754,-3.12755430186282 55.9650582401616,-3.12669046884314 55.9645539125703,-3.12280878716787 55.9621899550795,-3.1213917025936 55.9613851007873,-3.11920918863691 55.9601468252985,-3.11888419207567 55.9599880212856,-3.11852459375104 55.9597396625383,-3.11556243602183 55.9581219993688,-3.11471207893324 55.9575186176385,-3.11443520513546 55.9573593667501,-3.11374192773661 55.9572038790152,-3.112708735936 55.9569256454847,-3.1104900203055 55.9560829591684,-3.10865959579804 55.9553715333906,-3.10859682748892 55.9554170227739,-3.10056693963241 55.9524246181409,-3.0990764446262 55.9518268450055,-3.09330581688641 55.9493889331724,-3.09303234663519 55.949346434458,-3.0907078757105 55.9492681814922,-3.0903396243887 55.9492714403735,-3.08886453571453 55.9492125964725,-3.08870491768108 55.9492319692825,-3.08850305728994 55.9494584126469,-3.088455521447 55.9494768134379,-3.08821610930362 55.9495058900423,-3.08749434448773 55.9494673186652,-3.08745852952756 55.9493328423526,-3.0871042658259 55.9492640813121,-3.08437701040906 55.9490993939583,-3.08413609097075 55.9490745516053,-3.0820930918468 55.9487510187712,-3.08071935421206 55.9483047731214,-3.07909699327377 55.9475551434026,-3.07857388588168 55.9477484397135,-3.07645325362787 55.9469312489919,-3.07607023407841 55.9469795189482,-3.07597440846557 55.9469893369567,-3.07488543376296 55.9469898596097,-3.07408166597788 55.9468800568973,-3.07319413490536 55.9466361679058,-3.0722365856282 55.9461772033051,-3.07150795118018 55.9458869949225,-3.07054336261413 55.9457515870854,-3.07025518015707 55.9457540904385,-3.06937336088717 55.9457168217626,-3.0684132365556 55.9457431128063,-3.06761519762765 55.9458398972282,-3.06705977340671 55.9460244433038,-3.06687482478969 55.9462866477129,-3.06666618297045 55.9462704730931,-3.06654230556457 55.9464243183167,-3.06639403034943 55.9462728286352,-3.06633167368434 55.9457521623332,-3.06626023052632 55.945483196348,-3.06609716037193 55.9453767588987,-3.06548975228437 55.9454179559188,-3.06521954621767 55.9454921971289,-3.06570851102079 55.9463866076824,-3.06587232435955 55.9465199829083,-3.06629380705434 55.9467050527035,-3.06609207508254 55.9469404390033,-3.06523610199366 55.9466782574285,-3.06474640462797 55.9457568893087,-3.06456930870571 55.945722476107,-3.06393453889762 55.9459346371954,-3.06233350639281 55.9459484504208,-3.06010433794081 55.9464169672691,-3.05883328194231 55.9467873654422,-3.05550524215278 55.9480740056174,-3.05488544182056 55.9482500481054,-3.05432775726337 55.9483536694686,-3.05138244473774 55.9489989058525,-3.0502970259612 55.9491339723616,-3.0486507278336 55.9492558226613,-3.04837928108841 55.9492850943309,-3.04829847416857 55.9492588197433,-3.04832175327553 55.9483420046961,-3.04830646061008 55.9477760057059,-3.04838894334337 55.9472720617264,-3.04859680793318 55.94607509251,-3.04877192358517 55.9454445675813,-3.04898951098828 55.9452000754424,-3.0507301689752 55.9438372893849,-3.05048854049243 55.9437854254616,-3.05021713339941 55.9438147010506,-3.0500119154208 55.9439242982011,-3.04894682323757 55.9448050445344,-3.04860286438305 55.9451134989937,-3.04833942406905 55.945439266689,-3.04812377205796 55.9457556092907,-3.0479733684904 55.9461163578603,-3.04762500807129 55.9474492938156,-3.04749545971379 55.9491757809858,-3.04749837083853 55.9492836043438,-3.04748843238779 55.9495083478284,-3.04720361230116 55.9490434697274,-3.04645324926257 55.9491307301085,-3.04544716136631 55.9492381180816,-3.04266496397626 55.9494054629388,-3.04070494061519 55.9455938306174,-3.03751725931749 55.9461598964597,-3.03367233730776 55.9461023425049,-3.02739726455562 55.9449866039386,-3.02258712131046 55.9447570144538,-3.0183256942883 55.947128774116,-3.01626776987108 55.9480443962851,-3.01401949653782 55.9490334361717,-3.01274992875386 55.9482530732832,-3.01333644783841 55.9461814036674,-3.01454446682941 55.9433856786172,-3.02202936841667 55.9393877979926,-3.02537574354464 55.9406001179153,-3.02622192756172 55.9429295274941,-3.03019800551034 55.9419078464479,-3.02853521369152 55.9395852822502,-3.03028416147688 55.9391213524985,-3.03024123497309 55.9375041560263,-3.03064270908711 55.9345353065089,-3.03412809092019 55.9331581272845,-3.04073839094717 55.9348997579167,-3.04004039160756 55.9327489075477,-3.03910562489378 55.9313189713176,-3.04568811475614 55.9344085280573,-3.04575821698942 55.934632592531,-3.04604213453764 55.9356636121877,-3.04781979594538 55.9362775605984,-3.05133635075577 55.936067868654,-3.05368944995207 55.9354636554707,-3.05531105679494 55.9350453814788,-3.05786465613401 55.9347538977165,-3.05862647592017 55.9350978249436,-3.06042312467173 55.9346420357786,-3.0591157195212 55.9336647747207,-3.05843628899219 55.9322327867118,-3.05981542242351 55.9299743307189,-3.06417584564497 55.9313745705291,-3.06692374907349 55.9323393120008,-3.06873876909908 55.9331413344975,-3.06542748239496 55.9344011633967,-3.06820035511614 55.936264301326,-3.0711306538755 55.9356996727914,-3.07376364460682 55.9400172013287,-3.06860900335863 55.9412212574637,-3.07152273858234 55.9423641956334,-3.07394646706587 55.9431518666391,-3.07400863014542 55.9453979238446,-3.07691785068816 55.9463610399697,-3.07769285703617 55.9465879055075,-3.07772336280615 55.9465337328397,-3.07914684180021 55.9458922195039,-3.08089295565419 55.9453377274264,-3.08313434532288 55.945318045727,-3.08679652265938 55.9445668949161,-3.0873835802239 55.9443729988718,-3.09060347342643 55.943275146178,-3.09617622240383 55.9421473359602,-3.0984999999168 55.9416503572583,-3.09967772138461 55.9413972102045,-3.10014046139086 55.9413391549591,-3.10232694120054 55.9410859711169,-3.10205347891608 55.9404773406835,-3.10091958154226 55.9388878894852,-3.09995269106427 55.9375395604623,-3.10114857615835 55.9368009894239,-3.10723609247471 55.9369261500625,-3.11230860170352 55.9368265536236,-3.10623821915602 55.9350569382029,-3.10294445487306 55.9357694515082,-3.09749988803168 55.9345959180079,-3.0977976395681 55.9349347380349,-3.09931901334901 55.9366465726459,-3.09633394275194 55.9363946041778,-3.0931916576666 55.9362427894452,-3.09165676756351 55.9351780201301,-3.09090358310383 55.9345825963815,-3.08622735298647 55.9356753292746,-3.0822226696789 55.9373191558542,-3.08132054955267 55.9376955106434,-3.07987444396367 55.935785099789,-3.08394889069495 55.9343474330943,-3.08343340393811 55.9336600048087,-3.08825022342889 55.9324493232729,-3.08964214396599 55.9335603238693,-3.09397660500866 55.9322817772603,-3.10077334860051 55.9309092132022,-3.11252635370868 55.9315764716546,-3.11230649354769 55.9339598821866,-3.11275592960833 55.9340007485958,-3.11706649923961 55.9341414765396,-3.11708249523321 55.9341413315029,-3.11707990980952 55.9340514866793,-3.1172569626103 55.9335286709797,-3.11752125600653 55.932699515145,-3.11796260484079 55.931347541568,-3.11809677767093 55.9304476775085,-3.12047580186028 55.9296801720566,-3.12096747252249 55.9295229248122,-3.12872256004334 55.9270257580572,-3.13120925781171 55.9299684987422,-3.13580715851181 55.9290005822556,-3.14088254779967 55.9279472027977,-3.14302795081503 55.9323127308481,-3.14202138162124 55.9329241648993,-3.13985310319393 55.9343191804431,-3.13943044387217 55.9346466020916,-3.13893901504713 55.9348129020453,-3.13521821577611 55.9356829844237,-3.1328207338579 55.9358218826838,-3.13091867332726 55.9359292252471,-3.12516463003576 55.9362604764171,-3.12629301767483 55.9425946324228,-3.12806963971943 55.9431175710406,-3.13130435532751 55.9453165667215,-3.13199039908756 55.945777551731,-3.13659904314323 55.9445668943553,-3.1419893645175 55.9427197417156,-3.14082913441281 55.9413825183267,-3.1347276660627 55.9408098187806,-3.13434188149362 55.9385667350533,-3.1418651217165 55.9384972412015,-3.14553265055654 55.9423273952859,-3.14698654149787 55.9438415788504,-3.1406410255222 55.9458775143845,-3.14635330058393 55.9495089618634,-3.14688943384171 55.9513911355422,-3.14933117583358 55.9527163569692,-3.15143147358065 55.9533258110017,-3.15463408233156 55.9532958458818,-3.15647850259049 55.9560643618375,-3.16066099492666 55.9566541028229,-3.16207533850602 55.9568115117061,-3.1642290865328 55.9570518084737,-3.16660787584314 55.9573168816527,-3.16884989170047 55.9572956380515,-3.17232148222378 55.9555552153122,-3.17102331530848 55.9539409965755,-3.16982459336186 55.9524336700419,-3.16849757483001 55.9509185488418,-3.1721531610074 55.9499851811804,-3.1742019989976 55.948887287549,-3.175113681336 55.9472610146052,-3.1748883155906 55.9451064051153,-3.17373231813734 55.9439491647621,-3.17275548634396 55.9434192716635,-3.17082629807155 55.9431680304727,-3.16713082027402 55.9427537652204,-3.17136358649187 55.9397480384504,-3.16859639674118 55.9382466009382,-3.16639864653323 55.9397052717144,-3.16247350534511 55.9369565473173,-3.15974977200608 55.9368923476692,-3.15669523643099 55.9364717376374,-3.15490784780735 55.935589855492,-3.15178945610411 55.9330129671094,-3.15415807947506 55.9319124121179,-3.15746268380591 55.9299942380737,-3.15426731309275 55.9285863737969,-3.15676902582916 55.9282034327001,-3.1591640358441 55.9280012006837,-3.16075084705631 55.9275369332933,-3.16184681975031 55.9267178000133,-3.16228118014818 55.9251860047855,-3.1622381577978 55.9237485631154,-3.16242316134509 55.923513154521,-3.1606138950783 55.9229550756422,-3.15898705078231 55.9220717407637,-3.1493121175669 55.9250380823469,-3.14425112336504 55.9216703145131,-3.14485668383649 55.9204964489835,-3.14594219445687 55.9193180974474,-3.14846483365667 55.918036493909,-3.14925677676437 55.9177595006595,-3.15084063005868 55.9172055357925,-3.15242443746191 55.9166515323047,-3.15431214519216 55.9155554651452,-3.1508462383256 55.911993269508,-3.1475469089106 55.9151334121894,-3.14617731646108 55.9164402176845,-3.14393537447301 55.9158409964249,-3.14133839910614 55.9151371751485,-3.13860186314233 55.9178584553527,-3.13625340065302 55.9201806923847,-3.13184472224059 55.9188194008674,-3.13053868270143 55.9179327270892,-3.12727378088822 55.9157160270148,-3.12595493105082 55.9143801160766,-3.12367894507046 55.9131427958748,-3.12476229696958 55.9118747828742,-3.12550483705893 55.9098909619629,-3.12239182201174 55.9090207213835,-3.12622339983824 55.9043217328746,-3.12799451016069 55.901960044174,-3.13041157809212 55.9025669256576,-3.13682642920445 55.8976551518493,-3.14058323784055 55.9003163714809,-3.14254443806792 55.9017360397155,-3.14405784400289 55.90261166096,-3.14503404808086 55.9031687461954,-3.1453000993271 55.9029685529089,-3.14671818208485 55.9022364405363,-3.14690291436483 55.901992075565,-3.14764056032008 55.9009697177215,-3.14887470994363 55.8994305085358,-3.14903143621056 55.8993211959008,-3.15012740218228 55.8985201601788,-3.15074041142918 55.8976157598769,-3.15164812434501 55.8969422823058,-3.15183576173121 55.8967967328672,-3.15212890736481 55.8958953351688,-3.15275784656869 55.8955299902944,-3.1545139824024 55.8954236678139,-3.15504241307828 55.8954456746505,-3.15627833899831 55.8950566350482,-3.15890926124989 55.8947892559068,-3.15844771616863 55.8986218864321,-3.15979397604593 55.9008558529559,-3.16280273514567 55.8998389719645,-3.16552118063078 55.8998132719511,-3.16696034237654 55.8997996419003,-3.17049184433715 55.9002154527802,-3.17368730887299 55.900095168039,-3.17541538183621 55.8995844125185,-3.17777180747488 55.9023926830989,-3.17785457901088 55.9051238071307,-3.16936280196644 55.905752930472,-3.16943282542393 55.9080797743981,-3.16482559054689 55.9086266895647,-3.16502864060417 55.910062620433,-3.16525865168587 55.9123969501962,-3.16974561259019 55.9126240240694,-3.17506506808833 55.9139213704909,-3.17494857148753 55.915360334098,-3.16870699029989 55.9153298481342,-3.16861457987006 55.9175773607722,-3.16851914498163 55.9202562653246,-3.16844324764708 55.9225216005074,-3.18573428633876 55.9227158276194,-3.18627465013419 55.9246876741488,-3.19602966755958 55.924413624812,-3.1978915687187 55.9225083496151,-3.19766229882739 55.9202639177848,-3.20037103306534 55.919878090866,-3.20203629590388 55.919906776622,-3.20436516216927 55.9196593630278,-3.20528327277196 55.9183023949225,-3.20432781089048 55.9174220638126,-3.2041299678694 55.9172352776301,-3.20182358227879 55.9151010273346,-3.20579490333379 55.9141635529731,-3.20607021901749 55.9127229987733,-3.20488992967291 55.9112966926042,-3.20442451104587 55.9107350829558,-3.20224658633796 55.908087347332,-3.19579886033782 55.9091206692289,-3.19202616895725 55.9050503547329,-3.19133777970827 55.9019027286479,-3.19209326510479 55.8994151043855,-3.19340389558966 55.8952146442595,-3.19842392744219 55.8961903620255,-3.20156837427243 55.8965012155897,-3.21488148671234 55.8977185768141,-3.21539455996754 55.8977584394122,-3.22947463465007 55.8989217286723,-3.22912864815395 55.9001204015188,-3.22951276523188 55.901644302836,-3.23099054996594 55.9013329842491,-3.23497405678061 55.9008437660091,-3.23941806130999 55.9007541908784,-3.23982401522371 55.902448582773,-3.23826380096153 55.9036864639565,-3.23927832822075 55.905401698881,-3.23990025523755 55.9048382731993,-3.24179064697455 55.9039205419472,-3.24481185377219 55.9033508545976,-3.24588100438855 55.9032681351223,-3.24710971598727 55.900182255569,-3.24762036487943 55.8986493425596,-3.25267315180487 55.8985980436866,-3.25489572838871 55.898575413086,-3.2619458026988 55.8989526967756,-3.26614413246233 55.9001677500064,-3.27057018640058 55.9034472429982,-3.27232736873812 55.9053252900492,-3.27571405567572 55.9042028608472,-3.27857192751652 55.9035441454103,-3.27967445986105 55.9030204504829,-3.28203671738895 55.9018905231482,-3.28551610066607 55.9006859661124,-3.2885453665338 55.9003847103502,-3.29205427420803 55.9000783295073,-3.29294133051102 55.8998173874292,-3.29490554288702 55.8992395770661,-3.29588584646114 55.8988967619106,-3.29685041857722 55.8985630676884,-3.29846335175739 55.8980068805283,-3.30069677195268 55.8973542295799,-3.3019659769187 55.8970442579445,-3.30313888462262 55.8967262922901,-3.30537550284805 55.8961723743245,-3.30224314666744 55.8938600046366,-3.30366698417938 55.8933955999142,-3.30021349954694 55.8905563525691,-3.30433976246293 55.8896140328392,-3.30951370437751 55.8950949605441,-3.31014363031413 55.8957532841256,-3.31487631170784 55.8938156125006,-3.31932227616298 55.8928693763841,-3.3234360780746 55.8915670635,-3.32691017576944 55.8902715257436,-3.33151840677023 55.8894129671792,-3.33315651831196 55.8882179645258,-3.33403910162408 55.8883072575181,-3.33562217308629 55.8878407538861,-3.33653803942019 55.8865726665886,-3.33603688592303 55.8859490229848,-3.33536668303462 55.8850576145565,-3.3345490024465 55.8845272696285,-3.33500693845776 55.8838932212156,-3.33528340123597 55.8826320743613,-3.33493601594185 55.8818270149099,-3.33544546905952 55.8808329556087,-3.33348855071133 55.8801801406041,-3.33230805598676 55.8797885275635,-3.3301222801878 55.8789853746482,-3.32783627107438 55.8799267157518,-3.32475078300308 55.8785220683688,-3.32505884690263 55.8777099264381,-3.32488413504002 55.8768041457586,-3.32452981954433 55.8767270687667,-3.3224457304403 55.8760844668214,-3.32332867365512 55.8743135451681,-3.32946836367087 55.8762244898542,-3.33287787033865 55.8744891101968,-3.3418648430253 55.8727289016318,-3.34750290096105 55.879982605736,-3.34901503831914 55.8807119459997,-3.34882017914443 55.8820081961701,-3.3490020168271 55.8831025929057,-3.3484327803918 55.883746895691,-3.34555581070334 55.8837783745317,-3.34381939433137 55.8844264254545,-3.34228931769311 55.8854945789153,-3.34324663028125 55.8868231770293,-3.34948991068102 55.8851821884249,-3.3502844934927 55.8864226634844,-3.35081705412387 55.8879445690823,-3.34363429867806 55.889712695199,-3.34501764697383 55.8913331894937,-3.33946270788585 55.8925620431072,-3.31524490897913 55.898565686043,-3.31299515095292 55.8996770950493,-3.30810480896803 55.9017062339574,-3.30049713037424 55.9042941097414,-3.2955792335551 55.9016948582927,-3.2921891316051 55.9026920591409,-3.29287437453401 55.9035745567772,-3.28884268496488 55.90500977048,-3.29138418222494 55.906870357992,-3.29471306368364 55.9059457151103,-3.29873505600306 55.9094890698501,-3.29731147190788 55.9099803730932,-3.29671031083105 55.9101844090287,-3.295615073415 55.9104475669263,-3.29299663711357 55.9110951624715,-3.293357486283 55.9113609856835,-3.29357320668828 55.9115923692724,-3.29341129001136 55.9120164420855,-3.29248463631624 55.9125384132591,-3.29295238135292 55.9126503374104,-3.29552516338031 55.9139892882883,-3.29065947094012 55.9163589377159,-3.29029719586051 55.916533493224,-3.29347699454934 55.91639228802,-3.29484691253332 55.9166834502373,-3.29599558693537 55.9170577962662,-3.29686353344045 55.9176507738927,-3.29857175947161 55.9204006756557,-3.29968749971899 55.9221772662865,-3.3040418598553 55.9284039902348,-3.3070517040343 55.9288933155006,-3.30878800336574 55.9310137219984,-3.30942018917144 55.9331458449341,-3.31174072574865 55.9331211582038,-3.31381746634267 55.9339347906124,-3.31440572342465 55.9352315948967,-3.31382381327529 55.9364869547096,-3.31509280842353 55.9389717205445,-3.31156039545794 55.939629469571,-3.31184096761682 55.9412980054401,-3.31397405272601 55.9409247927164,-3.31575675045509 55.9406092112467,-3.32218096733455 55.9421131107549,-3.3221883425222 55.9437396303933,-3.3194894741374 55.944900880912,-3.31345135544325 55.9453518214679,-3.31317426913814 55.9475745012749,-3.31308306569669 55.9477192513023,-3.31151038944511 55.9504679668413,-3.30630420552017 55.9580540989422,-3.31507295919238 55.9582304499354,-3.31599623678649 55.9599460392444,-3.31699678266866 55.9611036107511,-3.31847478883062 55.9621662153261,-3.31907598397662 55.963355023242,-3.32002015889289 55.9652051554558,-3.31769775277099 55.9661735992193,-3.31512197955205 55.967234590779,-3.31493556850972 55.9674073202661,-3.31529740155408 55.9676820517738,-3.31470848514496 55.969216073784,-3.31188898053972 55.9711333156804,-3.30893025831456 55.9736810231524,-3.30375382773195 55.9755871344526,-3.3017230249143 55.9762017236874),(-3.27789267066317 55.9607064879974,-3.27650793548448 55.957575522096,-3.2761253496082 55.9551980149926,-3.27590340544078 55.9538073937973,-3.27706015899088 55.9500210017476,-3.27764265351968 55.9477683051274,-3.27041628602966 55.9476633001976,-3.27005196367939 55.9463190434828,-3.26765937209463 55.9466132913116,-3.26817762241054 55.9418899604548,-3.26827778190512 55.9410351920988,-3.26368295162715 55.934665948296,-3.25738704320152 55.936024434941,-3.25220411572732 55.9371556244859,-3.25483533074411 55.9388093445027,-3.25793098395656 55.9399640298333,-3.26035445996714 55.9406312222918,-3.26255903801628 55.9424419385141,-3.25302684695568 55.9447858991501,-3.25599568274247 55.9474516550893,-3.25312549304467 55.947840356604,-3.25251990060634 55.9489248950266,-3.24789127477037 55.9494211861847,-3.24808318013096 55.9504077716565,-3.24344568007577 55.9506343940335,-3.2473420422852 55.9572451048372,-3.25067890241922 55.9564024966083,-3.25531122989536 55.9559959191824,-3.25835084972197 55.955875067944,-3.26140216820579 55.9561134639017,-3.26399652128573 55.9570754117782,-3.26580788720369 55.9585845503097,-3.26762233063284 55.9601834823206,-3.2714276397186 55.9589760315417,-3.27539523364873 55.9627094205808,-3.27187758244368 55.9629255117004,-3.27194830808206 55.9650815634062,-3.28062446535943 55.9643536678734,-3.27970767809335 55.9623052574374,-3.27789267066317 55.9607064879974),(-3.26994336136659 55.9165742806015,-3.26524509135032 55.9118596899244,-3.26320370962496 55.9130489223777,-3.25678713685242 55.9115598651311,-3.25134371887677 55.9124510509163,-3.24770705744638 55.9108164320081,-3.24289482404545 55.9134352868978,-3.2469457029577 55.9150119288113,-3.24570920604383 55.9163724370443,-3.2457236114758 55.9168216232318,-3.24575530498576 55.9178098363997,-3.2451528101114 55.9189842021912,-3.24536176812992 55.9205098245784,-3.24731048999244 55.9213887697719,-3.24846007018429 55.920307701299,-3.24960301181283 55.9200175381229,-3.25177534053361 55.9198876289641,-3.25236649459999 55.919360398964,-3.25228271768941 55.9192444177749,-3.25169761701803 55.9184685338565,-3.25697400639752 55.9183249301022,-3.25829746411333 55.9166938083266,-3.25851269521646 55.9164220170341,-3.2565581610315 55.9153635672749,-3.25732019152352 55.9141875326874,-3.26053107620497 55.9145141747942,-3.26141688844866 55.9166619001284,-3.26157254990115 55.917019786843,-3.26188809312316 55.9193440887676,-3.26199174832878 55.9200709516508,-3.26210753476475 55.9201865984045,-3.26348129303079 55.9215834198046,-3.26290852672241 55.9236562345051,-3.27136641156326 55.9194713037493,-3.27235838588564 55.9189757643743,-3.27022442620249 55.9168499749006,-3.26994336136659 55.9165742806015),(-3.20953133392698 55.9622051350911,-3.20828080837176 55.9632059227941,-3.20366386865739 55.9641497690192,-3.20778006600943 55.9677041102566,-3.21196092409056 55.9666386063676,-3.21258280117093 55.967567086382,-3.21689932331451 55.9672549568817,-3.21763315910932 55.970213275423,-3.22289409399829 55.9693523902422,-3.22865527153597 55.9691153774265,-3.23455943636612 55.9683374476742,-3.23237704535789 55.9652139945985,-3.22933008762295 55.9626023644257,-3.22385095238622 55.9641306888908,-3.22456539242608 55.9664600974755,-3.22187064757839 55.9673854947351,-3.21970914533978 55.9648906806212,-3.21835434785341 55.9625675768922,-3.21668224478149 55.9603374418771,-3.20953133392698 55.9622051350911),(-3.22784814731929 55.9233816343962,-3.22211916013829 55.9244271369061,-3.22087659476443 55.926650162838,-3.22060381920332 55.9271381397352,-3.22196879453916 55.9298206029522,-3.22617741935752 55.9277478003449,-3.23185719094392 55.9246356914518,-3.2342481759355 55.9233176727772,-3.23798224365639 55.9199551438812,-3.23365403367436 55.9197289783776,-3.23029147912977 55.9196727407438,-3.22579767914994 55.9192682138615,-3.22784814731929 55.9233816343962),(-3.24089136029476 55.905816806779,-3.23568372456424 55.9110904307632,-3.23120631944707 55.9131932077011,-3.23394275229634 55.9137050233772,-3.23667067696688 55.9139472724955,-3.24125774062583 55.9112770075512,-3.24720638282564 55.9081794158791,-3.24089136029476 55.905816806779),(-3.24355457159649 55.9390405537689,-3.23806814197431 55.9402191321308,-3.23809556530984 55.9435888472519,-3.23190933611583 55.9454481693295,-3.23464519977172 55.9458701153969,-3.23536817450897 55.9459437571685,-3.23639764427226 55.9455829532687,-3.23847595882862 55.9454722118423,-3.24005964591259 55.9449170846821,-3.24293551072142 55.9447083689305,-3.24314018338397 55.9445984716171,-3.24482487655653 55.9437007660835,-3.24559645795192 55.9427943083925,-3.24590506093192 55.9424317278521,-3.24522151273149 55.9410906476193,-3.24481849131569 55.9400073389161,-3.24469520509482 55.9396581054372,-3.24492219082599 55.9387481517414,-3.24355457159649 55.9390405537689),(-3.11465286762238 55.9437519010919,-3.10825192703639 55.9444656404059,-3.10936863839827 55.9482389002073,-3.11170723884426 55.9488109199567,-3.11286854779102 55.9490970038674,-3.11760622762587 55.9506626967363,-3.11768492371674 55.9495027348695,-3.11598557163091 55.9461032788883,-3.11497074508508 55.9442253094875,-3.11465286762238 55.9437519010919),(-3.25000915827759 55.9256750077844,-3.24798315567491 55.9268817856949,-3.25200496050218 55.9294920382679,-3.25204804791188 55.9293388232608,-3.25331952732877 55.9290563023099,-3.25523690921627 55.9289469099293,-3.25540537872381 55.9287115458755,-3.25585083920155 55.9281318593317,-3.2562404218568 55.9278043512405,-3.25841842556714 55.9283303227579,-3.26155419726615 55.9277860099924,-3.26297008372162 55.9289936836992,-3.26435017088072 55.9281168066806,-3.26253073476506 55.9268054337821,-3.25965633962495 55.9270146004448,-3.25918935639446 55.926929504729,-3.25740156850776 55.9265883046127,-3.25626406107783 55.9260607085354,-3.25435262857047 55.9263497788374,-3.25417690895226 55.9263605679123,-3.25195534846961 55.9264640364724,-3.2509822432177 55.9260695168309,-3.25000915827759 55.9256750077844),(-3.13484386554414 55.961208045853,-3.13493326395121 55.9642626265494,-3.13768788208577 55.965315592505,-3.13980717232307 55.9665541287933,-3.14442071295392 55.9654329984222,-3.14325176233632 55.9638262752803,-3.14052088276784 55.9635819898823,-3.13756927311425 55.9612727887991,-3.13484386554414 55.961208045853),(-3.19401235165781 55.9681078365796,-3.19145486437702 55.9683123219267,-3.18899071821931 55.9684259850667,-3.18889459422308 55.9684269122679,-3.18849270846653 55.9689070751245,-3.19105711449184 55.9710121147533,-3.19225970206221 55.9705152200957,-3.19374728970841 55.9699077223473,-3.19729122767478 55.9720660499554,-3.2005283403478 55.9715492958867,-3.19901428527224 55.9692275378739,-3.19709751689128 55.9694259057822,-3.19527971263049 55.9676372465255,-3.19401235165781 55.9681078365796),(-3.21546585422794 55.9164050131597,-3.21648158199496 55.9130699346475,-3.21616136928108 55.9130641155512,-3.21104013137027 55.9130336904555,-3.21122250534678 55.9137508360228,-3.21099218489484 55.9166288190171,-3.21097701253121 55.9171681490999,-3.21090081888057 55.918831421444,-3.21202772328308 55.9190450025266,-3.21204371252065 55.9190448451899,-3.21330480944382 55.9189425780376,-3.21484844583737 55.9171300249796,-3.21546585422794 55.9164050131597),(-3.30386258735072 55.9378419309345,-3.29700432339974 55.9362428015768,-3.29764758091722 55.9411157912485,-3.30330408241257 55.9407595301324,-3.30386258735072 55.9378419309345),(-3.24556533734785 55.9368364971728,-3.24606369259329 55.9373976024513,-3.25332480522926 55.9341786330384,-3.25166659293681 55.933395680612,-3.25012102881908 55.9341213144965,-3.24889156594638 55.934223653944,-3.2478940039277 55.9320769780068,-3.24369335314012 55.9333775789841,-3.24473423343467 55.9358833288796,-3.24556533734785 55.9368364971728),(-3.18393760819313 55.9404276567804,-3.18052595799948 55.9409186998739,-3.18359479463767 55.9417879291944,-3.1893851878757 55.9426308231463,-3.19338175635645 55.9424124413294,-3.19736438559753 55.9417447379733,-3.19269173621898 55.9408015348803,-3.18771012116536 55.940220610408,-3.18393760819313 55.9404276567804),(-3.16024462306862 55.9695087020287,-3.15705140700888 55.9698981724286,-3.15650755807457 55.9699302385828,-3.15321202474655 55.9701138888124,-3.15050197173663 55.9705885357641,-3.15052863557403 55.9714869314176,-3.15723574776298 55.9707052375076,-3.15839474795519 55.9719524509441,-3.15971400799527 55.9731981643953,-3.16191119960363 55.9716497684932,-3.16303564000532 55.9690690195048,-3.16024462306862 55.9695087020287),(-3.27461817343358 55.9288287678055,-3.27299705449378 55.925277830518,-3.26767848100631 55.9266087886851,-3.26930227507966 55.9297643585931,-3.27461817343358 55.9288287678055),(-3.03803753587634 55.941662335823,-3.03484055374556 55.9418689434053,-3.03259454766653 55.9417080699942,-3.03408320592841 55.9434928567011,-3.03923751874937 55.9446177122503,-3.04128266178238 55.9432524925763,-3.04122239751084 55.9410064108878,-3.03803753587634 55.941662335823),(-3.28769138536098 55.9277132673373,-3.28634296185632 55.9246988336373,-3.28059407340594 55.9255855120431,-3.2819486170143 55.9283123681283,-3.28769138536098 55.9277132673373),(-3.15613904185849 55.9769161926368,-3.15567173838189 55.9773698965177,-3.15243511710861 55.9763218162731,-3.15198112897005 55.9772247034714,-3.15780303227354 55.9789674687881,-3.1591913899623 55.9771571142851,-3.15335903800576 55.9750550772555,-3.15289974085441 55.9757782816848,-3.15613904185849 55.9769161926368),(-3.28149124311033 55.9580989491376,-3.28072198517355 55.9590595339257,-3.28152152169962 55.9590152597639,-3.28264076507337 55.9589497088647,-3.28481730144814 55.9569499708108,-3.28509591312624 55.9556889224166,-3.28269692099075 55.9558037859989,-3.28195268068755 55.9575190044172,-3.28149124311033 55.9580989491376),(-3.29505438491691 55.9574539081408,-3.29433203135498 55.9559697044061,-3.2896094576743 55.9565404543197,-3.29110149517751 55.9580525493816,-3.29505438491691 55.9574539081408),(-3.16488303435989 55.9798892664204,-3.16375059655305 55.9795405074685,-3.16389465010037 55.9789999568717,-3.16033988917141 55.9780449540334,-3.1590822076086 55.9788655802936,-3.16457877756166 55.9804313316249,-3.16488303435989 55.9798892664204),(-3.24327413821838 55.9607730085657,-3.24185509060199 55.960985017231,-3.24017094861158 55.9634283562056,-3.24320832287707 55.9632180353173,-3.24327413821838 55.9607730085657))"));
		} catch (Exception e) {
		}
		testFootprints.add(testFootprint);
		testFootprintResult.setFootprints(testFootprints);
		result.setFootprints(testFootprints);
		result.setFeatureTypes(testFeatureTypes);
	}

	@Test
	public void testGetFeaturesForName() {
		mockSpatialDao = createMock(ISpatialDao.class);
		spatialService.setSpatialDao(mockSpatialDao);
		expect(mockSpatialDao.getFeaturesForName("Durham County", 0, 10, null, country, count, srs, null, null)).andReturn(result).once();
		replay(mockSpatialDao);
		List<IFeature> features = spatialService.getFeaturesForName("Durham County", 0, 10, null, country, count, srs, null, null).getFeatures();
		verify(mockSpatialDao);
		assertNotNull(features);
		assertEquals(testFeatures, features);
		IFeature feature = testFeatures.get(0);
		assertEquals(testFeature, feature);
		assertEquals(testFeature.getNameOptimised(), feature.getNameOptimised());
		assertEquals(testFeature.toString(), feature.toString());
		assertEquals(testFeature.hashCode(), feature.hashCode());
	}

	@Test
	public void testGetFootprintForIdentifier() {
		mockSpatialDao = createMock(ISpatialDao.class);
		spatialService.setSpatialDao(mockSpatialDao);
		String identifier = new String("12345");
		expect(mockSpatialDao.getFootprintsForIdentifier(identifier, srs)).andReturn(testFootprintResult).once();
		replay(mockSpatialDao);
		Footprint footprint = (Footprint) spatialService.getFootprintsForIdentifier(identifier, srs).getFootprints().get(0);
		verify(mockSpatialDao);
		assertNotNull(footprint);
		assertEquals(testFootprint, footprint);
	}

	@Test
	public void testGetDeepAttestation() {
		mockSpatialDao = createMock(ISpatialDao.class);
		spatialService.setSpatialDao(mockSpatialDao);
		String variantId = "epns-deep-27-b-name-w41007";
		expect(mockSpatialDao.getDeepAttestation(variantId)).andReturn(deepResult).once();
		replay(mockSpatialDao);
		Document result = spatialService.getDeepAttestation(variantId).getDeepAttestations();
		verify(mockSpatialDao);
		assertNotNull(result);
		assertEquals(deepResult.getDeepAttestations(), result); 
	}

	@Test
	public void testGetFeaturesForNameAndFeature() {
		mockSpatialDao = createMock(ISpatialDao.class);
		spatialService.setSpatialDao(mockSpatialDao);
		expect(mockSpatialDao.getFeaturesForNameAndFeature("Durham County", "county", 0, 10, null, country, count, srs, searchVariants, deepSrc))
				.andReturn(result).once();
		replay(mockSpatialDao);
		List<IFeature> features = spatialService.getFeaturesForNameAndFeature("Durham County", "county", 0, 10, null, country, count, srs,
				searchVariants, deepSrc).getFeatures();
		verify(mockSpatialDao);
		assertNotNull(features);
		assertEquals(testFeatures, features);
		IFeature feature = testFeatures.get(0);
		assertEquals(testFeature, feature);
	}

	@Test
	public void testGetFeaturesForPostCode() {
		mockSpatialDao = createMock(ISpatialDao.class);
		spatialService.setSpatialDao(mockSpatialDao);
		expect(mockSpatialDao.getFeaturesForPostCode("Durham County", 0, 1, null, country, count, srs)).andReturn(result).once();
		replay(mockSpatialDao);
		List<IFeature> features = spatialService.getFeaturesForPostCode("Durham County", 0, 1, null, country, count, srs).getFeatures();
		verify(mockSpatialDao);
		assertNotNull(features);
		assertEquals(testFeatures, features);
		IFeature feature = testFeatures.get(0);
		assertEquals(testFeature, feature);
	}

	@Test
	public void testGetFeaturesForSpatialFeatureSearch() {
		mockSpatialDao = createMock(ISpatialDao.class);
		spatialService.setSpatialDao(mockSpatialDao);
		BoundingBox bbox = new BoundingBox(-2.354266881942749, 54.45132827758789, -1.2380768060684204, 54.918609619140625);
		expect(
				mockSpatialDao.getFeaturesForFeatureTypeAndBBox("county", bbox, "within", 0, 1, null, country, count, srs, srs_in, searchVariants,
						deepSrc)).andReturn(result).once();
		replay(mockSpatialDao);
		List<IFeature> features = spatialService.getFeaturesForFeatureTypeAndBBox("county", bbox, "within", 0, 1, null, country, count, srs, srs_in,
				searchVariants, deepSrc).getFeatures();
		verify(mockSpatialDao);
		assertNotNull(features);
		assertEquals(testFeatures, features);
		IFeature feature = testFeatures.get(0);
		assertEquals(testFeature, feature);
	}

	@Test
	public void testGetFeaturesForSpatialNameSearch() {
		mockSpatialDao = createMock(ISpatialDao.class);
		spatialService.setSpatialDao(mockSpatialDao);
		BoundingBox bbox = new BoundingBox(-2.354266881942749, 54.45132827758789, -1.2380768060684204, 54.918609619140625);
		expect(mockSpatialDao.getFeaturesForNameAndBBox("county", bbox, "within", 0, 1, null, country, count, srs, srs_in, searchVariants, deepSrc))
				.andReturn(result).once();
		replay(mockSpatialDao);
		List<IFeature> features = spatialService.getFeaturesForNameAndBBox("county", bbox, "within", 0, 1, null, country, count, srs, srs_in,
				searchVariants, deepSrc).getFeatures();
		verify(mockSpatialDao);
		assertNotNull(features);
		assertEquals(testFeatures, features);
		IFeature feature = testFeatures.get(0);
		assertEquals(testFeature, feature);
	}

	@Test
	public void testGetSupportedFeatures() {
		mockSpatialDao = createMock(ISpatialDao.class);
		spatialService.setSpatialDao(mockSpatialDao);
		expect(mockSpatialDao.getFeatureTypes(null)).andReturn(result).once();
		replay(mockSpatialDao);
		List<IFeatureType> featureTypes = spatialService.getFeatureTypes(null).getFeatureTypes();
		verify(mockSpatialDao);
		assertNotNull(featureTypes);
		assertEquals(testFeatureTypes, featureTypes);
		IFeatureType featureType = testFeatureTypes.get(0);
		assertEquals(testFeatureType, featureType);
	}

	@Test
	public void testGetFeaturesForClosestMatch() {
		mockSpatialDao = createMock(ISpatialDao.class);
		spatialService.setSpatialDao(mockSpatialDao);
		expect(mockSpatialDao.getFeaturesForClosestMatchSearch("Durham County", 0, 10, null, country, count, srs, null, null)).andReturn(result)
				.once();
		replay(mockSpatialDao);
		List<IFeature> features = spatialService.getFeaturesForClosestMatchSearch("Durham County", 0, 10, null, country, count, srs, null, null)
				.getFeatures();
		verify(mockSpatialDao);
		assertNotNull(features);
		assertEquals(testFeatures, features);
		IFeature feature = testFeatures.get(0);
		assertEquals(testFeature, feature);
		assertEquals(testFeature.getNameOptimised(), feature.getNameOptimised());
		assertEquals(testFeature.toString(), feature.toString());
		assertEquals(testFeature.hashCode(), feature.hashCode());
	}

	@Test
	public void testGetFeaturesForUniqueName() {
		mockSpatialDao = createMock(ISpatialDao.class);
		spatialService.setSpatialDao(mockSpatialDao);
		expect(mockSpatialDao.getFeaturesForUniqueNameSearch("Durham County", 0, 10, null, country, count, srs, searchVariants, deepSrc)).andReturn(
				result).once();
		replay(mockSpatialDao);
		List<IFeature> features = spatialService.getFeaturesForUniqueNameSearch("Durham County", 0, 10, null, country, count, srs, searchVariants,
				deepSrc).getFeatures();
		verify(mockSpatialDao);
		assertNotNull(features);
		assertEquals(testFeatures, features);
		IFeature feature = testFeatures.get(0);
		assertEquals(testFeature, feature);
		assertEquals(testFeature.getNameOptimised(), feature.getNameOptimised());
		assertEquals(testFeature.toString(), feature.toString());
		assertEquals(testFeature.hashCode(), feature.hashCode());
	}

	@Test
	public void testGetFeaturesForIdentifier() {
		mockSpatialDao = createMock(ISpatialDao.class);
		spatialService.setSpatialDao(mockSpatialDao);
		expect(mockSpatialDao.getFeaturesForIdentifier(identifier, srs, searchVariants, deepSrc)).andReturn(result).once();
		replay(mockSpatialDao);
		List<IFeature> features = spatialService.getFeaturesForIdentifier(identifier, srs, searchVariants, deepSrc).getFeatures();
		verify(mockSpatialDao);
		assertNotNull(features);
		assertEquals(testFeatures, features);
		IFeature feature = testFeatures.get(0);
		assertEquals(testFeature, feature);
		assertEquals(testFeature.getNameOptimised(), feature.getNameOptimised());
		assertEquals(testFeature.toString(), feature.toString());
		assertEquals(testFeature.hashCode(), feature.hashCode());
	}

	@Test
	public void testGetDistanceBetweenIdentifiers() {
		mockSpatialDao = createMock(ISpatialDao.class);
		spatialService.setSpatialDao(mockSpatialDao);
		DefaultResult result = new DefaultResult();
		result.setDistanceBetweenFeatures(100);
		expect(mockSpatialDao.getDistanceBetweenFeatures(20, 120)).andReturn(result).once();
		replay(mockSpatialDao);
		IResult res = spatialService.getDistanceBewteenFeatures(20, 120);
		verify(mockSpatialDao);
		assertEquals(Integer.valueOf(100), res.getDistanceBetweenFeatures());

	}

}